<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Alignment and interpolation of inelastic scattering data &mdash; scikit-beam 0.0.7 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.4/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="scikit-beam 0.0.7 documentation" href="../index.html" />
    <link rel="up" title="Tutorial with Examples" href="../tutorial.html" />
    <link rel="next" title="[broken] An almost correct diffraction calibration notebook" href="D_estimate_demo.html" />
    <link rel="prev" title="3D histogramming" href="histogram3D.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          scikit-beam</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.7</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../tutorial.html">Tutorial</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to scikit-beam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing scikit-beam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html#updating-your-installation">Updating Your Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">What&#8217;s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource/api/index.html">Complete Reference (API)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource/dev_guide/index.html">Development Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial with Examples</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Generate_ROI_labeled_arrays.html">Generate Region of Interests (ROI) labeled arrays for simple shapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="dpc_demo.html">Differential Phase Contrast</a></li>
<li class="toctree-l1"><a class="reference internal" href="Histogram2D-RingAveraging.html">Using two histograms to bin in space and time</a></li>
<li class="toctree-l1"><a class="reference internal" href="Histogram2D.html">Computing a 2D histogram using Histogram object</a></li>
<li class="toctree-l1"><a class="reference internal" href="histogram3D.html">3D histogramming</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Alignment and interpolation of inelastic scattering data</a></li>
<li class="toctree-l1"><a class="reference internal" href="D_estimate_demo.html">[broken] An <strong>almost</strong> correct diffraction calibration notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="recip_example.html">This is an example of using real experimental data to plot the HK plane</a></li>
<li class="toctree-l1"><a class="reference internal" href="X-ray_Speckle_Visibility_Spectroscopy.html">X-ray Speckle Visibility Spectroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="speckle-plotting.html">Plotting helper functions for Speckle analysis &#8211; <code class="docutils literal"><span class="pre">xray_vision.mpl_plotting.speckle</span></code> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="Check_remove_bad_imgs_using_same_image.html">Remove bad images for one time correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Multi_tau_one_time_correlation_example.html">One Time Correlation Example for NIPA_GEL 250K¶</a></li>
<li class="toctree-l1"><a class="reference internal" href="Removing_bad_images_one_time_correlation.html">Removing bad images from images set and get the one time correlation data</a></li>
<li class="toctree-l1"><a class="reference internal" href="XPCS_fitting_with_lmfit.html">XPCS fitting with lmfit</a></li>
<li class="toctree-l1"><a class="reference internal" href="partial-multi-tau.html">First, let&#8217;s demo with synthetic data.</a></li>
<li class="toctree-l1"><a class="reference internal" href="partial-multi-tau.html#show-the-correlator-working-with-synthetic-data">Show the correlator working with synthetic data</a></li>
<li class="toctree-l1"><a class="reference internal" href="partial-multi-tau.html#now-let-s-do-it-with-some-real-data">Now let&#8217;s do it with some real data</a></li>
<li class="toctree-l1"><a class="reference internal" href="two-time-correlation.html">Two time correlation example notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="plot_xrf_spectrum.html">Using X-ray fluorescence information in scikit-beam</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Alignment and interpolation of inelastic scattering data</a><ul>
<li><a class="reference internal" href="#some-required-parameters-this-section-requires-editing">Some required parameters (This section requires editing!)</a></li>
<li><a class="reference internal" href="#the-boring-stuff">The boring stuff</a><ul>
<li><a class="reference internal" href="#imports">Imports</a></li>
<li><a class="reference internal" href="#defining-required-objects-and-functions">Defining required objects and functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-exciting-stuff">The exciting stuff!</a><ul>
<li><a class="reference internal" href="#open-the-spec-file-with-the-specfile-object-defined-above">Open the spec file with the Specfile object defined above</a></li>
<li><a class="reference internal" href="#plot-the-raw-data-to-make-sure-it-looks-ok">Plot the raw data to make sure it looks ok</a></li>
<li><a class="reference internal" href="#normalize-the-data-by-the-monitor-value-defined-in-the-first-cell">Normalize the data by the monitor value defined in the first cell</a></li>
<li><a class="reference internal" href="#plot-the-normalized-data-to-make-sure-it-looks-ok">Plot the normalized data to make sure it looks ok</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fit-to-a-linear-model-plus-a-lorentzian-model">Fit to a linear model plus a lorentzian model</a><ul>
<li><a class="reference internal" href="#plot-the-fits-to-make-sure-they-look-ok">Plot the fits to make sure they look ok!</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shift-the-peaks-to-a-zero-energy-transfer-based-on-the-center-of-the-lorentzian-model">Shift the peaks to a zero energy transfer based on the center of the Lorentzian model</a><ul>
<li><a class="reference internal" href="#plot-the-shifted-peaks-to-make-sure-they-look-ok">Plot the shifted peaks to make sure they look ok!</a></li>
<li><a class="reference internal" href="#compute-the-new-axis-onto-which-the-data-should-be-interpolated">Compute the new axis onto which the data should be interpolated</a></li>
</ul>
</li>
<li><a class="reference internal" href="#set-up-the-interpolator">Set up the interpolator</a><ul>
<li><a class="reference internal" href="#plot-the-new-interpolated-values">Plot the new interpolated values</a></li>
<li><a class="reference internal" href="#just-take-the-straight-sum-of-all-data-in-the-data-frame">Just take the straight sum of all data in the data frame</a></li>
<li><a class="reference internal" href="#ok-that-looks-a-little-weird-let-s-divide-the-sum-by-the-number-of-channels-at-each-x-value">Ok, that looks a little weird, let&#8217;s divide the sum by the number of channels at each x value</a></li>
<li><a class="reference internal" href="#hmm-that-still-looks-a-little-strange-lets-just-sum-the-channels-where-they-all-have-values">Hmm, that still looks a little strange, lets just sum the channels where they <strong>all</strong> have values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#output-the-data">Output the data</a><ul>
<li><a class="reference internal" href="#show-that-we-actually-output-the-data">Show that we actually output the data...</a></li>
</ul>
</li>
<li><a class="reference internal" href="#if-you-are-working-in-the-notebook-and-want-to-download-this-data-file-to-your-local-computer-follow-these-steps">If you are working in the notebook and want to download this data file to your local computer, follow these steps:</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="alignment-and-interpolation-of-inelastic-scattering-data">
<h1>Alignment and interpolation of inelastic scattering data<a class="headerlink" href="#alignment-and-interpolation-of-inelastic-scattering-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="some-required-parameters-this-section-requires-editing">
<h2>Some required parameters (This section requires editing!)<a class="headerlink" href="#some-required-parameters-this-section-requires-editing" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">ls</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>20151111  IXS-alignment-clean.ipynb
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c1"># the name of the file that you wish to open</span>
<span class="n">specfilename</span> <span class="o">=</span> <span class="s1">&#39;20151111&#39;</span>
<span class="c1"># the name of the x column</span>
<span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;MCMY&#39;</span>
<span class="c1"># the name of the detector (y column)</span>
<span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;PD21&#39;</span>
<span class="c1"># the name of the monitor column</span>
<span class="n">monitor</span> <span class="o">=</span> <span class="s1">&#39;SRcur&#39;</span>
<span class="c1"># the scans that you wish to process</span>
<span class="n">scans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">108</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">114</span><span class="p">]</span>
<span class="c1"># the name of the output file that you are going to write</span>
<span class="n">output_file_name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">specfilename</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">monitor</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">scan</span><span class="p">)</span> <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;output file name is going to be: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">output_file_name</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>output file name is going to be: 20151111-MCMY-PD21-SRcur-108_110_112_114
</pre></div>
</div>
<p>Specify the kind of interpolation you want to use as a string</p>
<div class="highlight-python"><div class="highlight"><pre>&#39;linear&#39;
&#39;nearest&#39;
&#39;zero&#39;
&#39;slinear&#39;
&#39;quadratic
&#39;cubic&#39;
</pre></div>
</div>
<p>where &#8216;slinear&#8217;, &#8216;quadratic&#8217; and &#8216;cubic&#8217; refer to a spline interpolation
of first, second or third order) or as an integer specifying the order
of the spline interpolator to use.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">interpolation_mode</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
<span class="c1"># The number to divide the step size by</span>
<span class="c1"># use a value &lt; 1 for more interpolated points</span>
<span class="c1"># use a value &gt; 1 for less interpolated points</span>
<span class="n">densify_interpolated_axis_factor</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="the-boring-stuff">
<h2>The boring stuff<a class="headerlink" href="#the-boring-stuff" title="Permalink to this headline">¶</a></h2>
<div class="section" id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre># Some imports that are required for this notebook
import matplotlib.pyplot as plt
from lmfit.models import LorentzianModel, LinearModel
import numpy as np
import os
import pandas as pd
%matplotlib inline
</pre></div>
</div>
<pre class="literal-block">
/home/edill/mc/envs/beam35/lib/python3.5/site-packages/IPython/html.py:14: ShimWarning: The <cite>IPython.html</cite> package has been deprecated. You should import from <cite>notebook</cite> instead. <cite>IPython.html.widgets</cite> has moved to <cite>ipywidgets</cite>.
  &quot;<cite>IPython.html.widgets</cite> has moved to <cite>ipywidgets</cite>.&quot;, ShimWarning)
</pre>
</div>
<div class="section" id="defining-required-objects-and-functions">
<h3>Defining required objects and functions<a class="headerlink" href="#defining-required-objects-and-functions" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Specfile</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">scan_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#S&#39;</span><span class="p">)</span>
        <span class="n">scan_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">section</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">scan_data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">scan_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="n">scan_data</span><span class="p">:</span>
            <span class="n">sid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="n">Specscan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

<span class="k">class</span> <span class="nc">Specscan</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specfile</span><span class="p">,</span> <span class="n">raw_scan_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specfile</span> <span class="o">=</span> <span class="n">specfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_scan_data</span> <span class="o">=</span> <span class="n">raw_scan_data</span>
        <span class="n">header_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_scan_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">header_row</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_command</span> <span class="o">=</span> <span class="n">header_row</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_args</span> <span class="o">=</span> <span class="n">header_row</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_scan_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#L&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">col_names</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">scan_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_scan_data</span>
                     <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">scan_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">col_names</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Specfile(&quot;</span><span class="si">%s</span><span class="s1">&quot;)[</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specfile</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_data</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="o">/</span><span class="n">ncols</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span> <span class="o">!=</span> <span class="n">ncols</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">!=</span> <span class="n">nrows</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">=</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">nrows</span><span class="p">,</span>
                                               <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span>
                                               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">ncols</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nrows</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arts</span><span class="p">[</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_data</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_data</span><span class="p">[</span><span class="n">data</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fit a lorentzian + linear background to `field` in `scan`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scan : Specscan object</span>
<span class="sd">    field : The field to fit</span>
<span class="sd">    bounds : The +/- range to fit the data to</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fit : lmfit.model.ModelFit</span>
<span class="sd">        The results of fitting the data to a linear + lorentzian peak</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; fit = fit_lorentzian(scan.scan_data)</span>
<span class="sd">    &gt;&gt;&gt; fit.plot()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lorentzian</span> <span class="o">=</span> <span class="n">LorentzianModel</span><span class="p">()</span>
    <span class="n">linear</span> <span class="o">=</span> <span class="n">LinearModel</span><span class="p">()</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">center</span> <span class="o">-</span> <span class="n">bounds</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">center</span> <span class="o">+</span> <span class="n">bounds</span>
        <span class="k">if</span> <span class="n">lower</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">upper</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
<span class="c1">#     print(&quot;Using bounds = {}&quot;.format(bounds))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">bounds</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">bounds</span><span class="p">]</span>
<span class="c1">#     print(&quot;Using x = {}&quot;.format(x))</span>
<span class="c1">#     print(&quot;Using y = {}&quot;.format(y))</span>
    <span class="n">lorentzian_params</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="o">.</span><span class="n">guess</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
    <span class="n">linear_params</span> <span class="o">=</span> <span class="n">linear</span><span class="o">.</span><span class="n">guess</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
    <span class="n">lorentzian_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">linear_params</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">lorentzian</span> <span class="o">+</span> <span class="n">linear</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">lorentzian_params</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plotter</span><span class="p">(</span><span class="n">xy</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">arts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scans</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
        <span class="n">arts</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-exciting-stuff">
<h2>The exciting stuff!<a class="headerlink" href="#the-exciting-stuff" title="Permalink to this headline">¶</a></h2>
<div class="section" id="open-the-spec-file-with-the-specfile-object-defined-above">
<h3>Open the spec file with the Specfile object defined above<a class="headerlink" href="#open-the-spec-file-with-the-specfile-object-defined-above" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="n">Specfile</span><span class="p">(</span><span class="n">specfilename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="plot-the-raw-data-to-make-sure-it-looks-ok">
<h3>Plot the raw data to make sure it looks ok<a class="headerlink" href="#plot-the-raw-data-to-make-sure-it-looks-ok" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">raw</span> <span class="o">=</span> <span class="p">[(</span>
        <span class="n">f</span><span class="p">[</span><span class="n">scan_id</span><span class="p">]</span><span class="o">.</span><span class="n">scan_data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">f</span><span class="p">[</span><span class="n">scan_id</span><span class="p">]</span><span class="o">.</span><span class="n">scan_data</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">scan_id</span> <span class="ow">in</span> <span class="n">scans</span><span class="p">]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c1"># Use the plotter helper function defined above</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/IXS-alignment-clean_16_0.png" src="../_images/IXS-alignment-clean_16_0.png" />
</div>
<div class="section" id="normalize-the-data-by-the-monitor-value-defined-in-the-first-cell">
<h3>Normalize the data by the monitor value defined in the first cell<a class="headerlink" href="#normalize-the-data-by-the-monitor-value-defined-in-the-first-cell" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">normalized</span> <span class="o">=</span> <span class="p">[(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span> <span class="o">/</span> <span class="n">f</span><span class="p">[</span><span class="n">scan_id</span><span class="p">]</span><span class="o">.</span><span class="n">scan_data</span><span class="p">[</span><span class="n">monitor</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">scan_id</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scans</span><span class="p">,</span> <span class="n">raw</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="plot-the-normalized-data-to-make-sure-it-looks-ok">
<h3>Plot the normalized data to make sure it looks ok<a class="headerlink" href="#plot-the-normalized-data-to-make-sure-it-looks-ok" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c1"># Use the plotter helper function defined above</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/IXS-alignment-clean_20_0.png" src="../_images/IXS-alignment-clean_20_0.png" />
</div>
</div>
<div class="section" id="fit-to-a-linear-model-plus-a-lorentzian-model">
<h2>Fit to a linear model plus a lorentzian model<a class="headerlink" href="#fit-to-a-linear-model-plus-a-lorentzian-model" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fits</span> <span class="o">=</span> <span class="p">[</span><span class="n">fit</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span> <span class="ow">in</span> <span class="n">normalized</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="plot-the-fits-to-make-sure-they-look-ok">
<h3>Plot the fits to make sure they look ok!<a class="headerlink" href="#plot-the-fits-to-make-sure-they-look-ok" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figsize&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">]}</span>
<span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scans</span><span class="p">,</span> <span class="n">fits</span><span class="p">):</span>
    <span class="n">title_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;scan_id: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sid</span><span class="p">}</span>
    <span class="n">f</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax_res_kws</span><span class="o">=</span><span class="n">title_dict</span><span class="p">,</span>
           <span class="n">ax_fit_kws</span><span class="o">=</span><span class="n">title_dict</span><span class="p">,</span> <span class="n">fig_kws</span><span class="o">=</span><span class="n">fig_kws</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/IXS-alignment-clean_24_0.png" src="../_images/IXS-alignment-clean_24_0.png" />
<img alt="../_images/IXS-alignment-clean_24_1.png" src="../_images/IXS-alignment-clean_24_1.png" />
<img alt="../_images/IXS-alignment-clean_24_2.png" src="../_images/IXS-alignment-clean_24_2.png" />
<img alt="../_images/IXS-alignment-clean_24_3.png" src="../_images/IXS-alignment-clean_24_3.png" />
</div>
</div>
<div class="section" id="shift-the-peaks-to-a-zero-energy-transfer-based-on-the-center-of-the-lorentzian-model">
<h2>Shift the peaks to a zero energy transfer based on the center of the Lorentzian model<a class="headerlink" href="#shift-the-peaks-to-a-zero-energy-transfer-based-on-the-center-of-the-lorentzian-model" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">zeroed</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">userkws</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">f</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fits</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="plot-the-shifted-peaks-to-make-sure-they-look-ok">
<h3>Plot the shifted peaks to make sure they look ok!<a class="headerlink" href="#plot-the-shifted-peaks-to-make-sure-they-look-ok" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plotter</span><span class="p">(</span><span class="n">zeroed</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/IXS-alignment-clean_28_0.png" src="../_images/IXS-alignment-clean_28_0.png" />
</div>
<div class="section" id="compute-the-new-axis-onto-which-the-data-should-be-interpolated">
<h3>Compute the new axis onto which the data should be interpolated<a class="headerlink" href="#compute-the-new-axis-onto-which-the-data-should-be-interpolated" title="Permalink to this headline">¶</a></h3>
<p>This new axis will be a linear space from the minimum value of all scans
to the maximum value of all scans with a step size equal to the average
step size between all data points</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">zeroed</span><span class="p">])</span>
<span class="n">minval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">zeroed</span><span class="p">])</span>
<span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">zeroed</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">diff</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mf">0.0095000000000000015</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24893695409799865</span><span class="p">,</span> <span class="mf">0.15106304590200137</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">new_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">diff</span> <span class="o">/</span> <span class="n">densify_interpolated_axis_factor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="set-up-the-interpolator">
<h2>Set up the interpolator<a class="headerlink" href="#set-up-the-interpolator" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">interpolaters</span> <span class="o">=</span> <span class="p">[</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">interpolation_mode</span><span class="p">,</span>
                          <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                          <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">zeroed</span><span class="p">]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c1"># Create a dict of the interpolated values so it can easily be passed to pandas</span>
<span class="n">interpolated</span> <span class="o">=</span> <span class="p">{</span><span class="n">sid</span><span class="p">:</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">new_axis</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">interpolator</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scans</span><span class="p">,</span> <span class="n">interpolaters</span><span class="p">)}</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">interpolated</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_axis</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="plot-the-new-interpolated-values">
<h3>Plot the new interpolated values<a class="headerlink" href="#plot-the-new-interpolated-values" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;-o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fdddb79e160&gt;
</pre></div>
</div>
<img alt="../_images/IXS-alignment-clean_39_1.png" src="../_images/IXS-alignment-clean_39_1.png" />
</div>
<div class="section" id="just-take-the-straight-sum-of-all-data-in-the-data-frame">
<h3>Just take the straight sum of all data in the data frame<a class="headerlink" href="#just-take-the-straight-sum-of-all-data-in-the-data-frame" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;-o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fdddb7c3550&gt;
</pre></div>
</div>
<img alt="../_images/IXS-alignment-clean_41_1.png" src="../_images/IXS-alignment-clean_41_1.png" />
</div>
<div class="section" id="ok-that-looks-a-little-weird-let-s-divide-the-sum-by-the-number-of-channels-at-each-x-value">
<h3>Ok, that looks a little weird, let&#8217;s divide the sum by the number of channels at each x value<a class="headerlink" href="#ok-that-looks-a-little-weird-let-s-divide-the-sum-by-the-number-of-channels-at-each-x-value" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;-o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fdddb644240&gt;
</pre></div>
</div>
<img alt="../_images/IXS-alignment-clean_43_1.png" src="../_images/IXS-alignment-clean_43_1.png" />
</div>
<div class="section" id="hmm-that-still-looks-a-little-strange-lets-just-sum-the-channels-where-they-all-have-values">
<h3>Hmm, that still looks a little strange, lets just sum the channels where they <strong>all</strong> have values<a class="headerlink" href="#hmm-that-still-looks-a-little-strange-lets-just-sum-the-channels-where-they-all-have-values" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;-o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fdddb74b780&gt;
</pre></div>
</div>
<img alt="../_images/IXS-alignment-clean_45_1.png" src="../_images/IXS-alignment-clean_45_1.png" />
</div>
</div>
<div class="section" id="output-the-data">
<h2>Output the data<a class="headerlink" href="#output-the-data" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="show-that-we-actually-output-the-data">
<h3>Show that we actually output the data...<a class="headerlink" href="#show-that-we-actually-output-the-data" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre>!cat 20151111-MCMY-PD21-SRcur-108_110_112_114
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="o">-</span><span class="mf">0.14443695409799856</span><span class="p">,</span><span class="mf">1.6874376948858338</span>
<span class="o">-</span><span class="mf">0.13493695409799855</span><span class="p">,</span><span class="mf">1.702554060125234</span>
<span class="o">-</span><span class="mf">0.12543695409799854</span><span class="p">,</span><span class="mf">1.6616389916220111</span>
<span class="o">-</span><span class="mf">0.11593695409799853</span><span class="p">,</span><span class="mf">1.7451558841638257</span>
<span class="o">-</span><span class="mf">0.10643695409799853</span><span class="p">,</span><span class="mf">1.795428105240191</span>
<span class="o">-</span><span class="mf">0.09693695409799852</span><span class="p">,</span><span class="mf">1.955000474391327</span>
<span class="o">-</span><span class="mf">0.08743695409799851</span><span class="p">,</span><span class="mf">1.9717883589338725</span>
<span class="o">-</span><span class="mf">0.0779369540979985</span><span class="p">,</span><span class="mf">1.9503549846016142</span>
<span class="o">-</span><span class="mf">0.06843695409799849</span><span class="p">,</span><span class="mf">2.106210881404486</span>
<span class="o">-</span><span class="mf">0.058936954097998484</span><span class="p">,</span><span class="mf">2.2141358308099015</span>
<span class="o">-</span><span class="mf">0.049436954097998476</span><span class="p">,</span><span class="mf">2.3436653558440663</span>
<span class="o">-</span><span class="mf">0.03993695409799847</span><span class="p">,</span><span class="mf">2.9097530034516734</span>
<span class="o">-</span><span class="mf">0.03043695409799846</span><span class="p">,</span><span class="mf">4.146455166987938</span>
<span class="o">-</span><span class="mf">0.02093695409799845</span><span class="p">,</span><span class="mf">5.873590301247516</span>
<span class="o">-</span><span class="mf">0.011436954097998442</span><span class="p">,</span><span class="mf">7.770183051573352</span>
<span class="o">-</span><span class="mf">0.0019369540979984334</span><span class="p">,</span><span class="mf">8.671919241394221</span>
<span class="mf">0.007563045902001575</span><span class="p">,</span><span class="mf">8.13868563734535</span>
<span class="mf">0.017063045902001583</span><span class="p">,</span><span class="mf">6.622442119962967</span>
<span class="mf">0.026563045902001592</span><span class="p">,</span><span class="mf">4.919072889735574</span>
<span class="mf">0.0360630459020016</span><span class="p">,</span><span class="mf">3.6586377836230515</span>
<span class="mf">0.04556304590200161</span><span class="p">,</span><span class="mf">2.8385456343052025</span>
<span class="mf">0.05506304590200162</span><span class="p">,</span><span class="mf">2.463075097632073</span>
<span class="mf">0.06456304590200163</span><span class="p">,</span><span class="mf">2.243716355738397</span>
<span class="mf">0.07406304590200163</span><span class="p">,</span><span class="mf">2.116251638483118</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="if-you-are-working-in-the-notebook-and-want-to-download-this-data-file-to-your-local-computer-follow-these-steps">
<h2>If you are working in the notebook and want to download this data file to your local computer, follow these steps:<a class="headerlink" href="#if-you-are-working-in-the-notebook-and-want-to-download-this-data-file-to-your-local-computer-follow-these-steps" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Figure out where that file lives with <code class="docutils literal"><span class="pre">!pwd</span></code></li>
<li>Remember the file name given by: <code class="docutils literal"><span class="pre">print(output_file_name)</span></code></li>
<li>Now that you know where the file lives, go back to the home page of
jupyter hub by right clicking on the Jupyter icon in the top-left of
this page and selecting &#8220;Open in new tab&#8221;</li>
<li>Then go to that new tab, navigate to the folder that was shown by
<code class="docutils literal"><span class="pre">!pwd</span></code> and open the file named <code class="docutils literal"><span class="pre">output_file_name</span></code>, shown above</li>
<li>Finally, open the file by left-clicking on it. Once it opens, select
File -&gt; Download</li>
</ol>
<div class="code python highlight-python"><div class="highlight"><pre>!pwd
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>/home/edill/dev/python/scikit-beam-examples/demos/inelastic
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>20151111-MCMY-PD21-SRcur-108_110_112_114
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/tutorial/IXS-alignment-clean.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2014-2015 Brookhaven National Lab.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>